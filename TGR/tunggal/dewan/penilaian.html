<!DOCTYPE html>
<html>

<head>
  <meta charset="utf-8" />
  <meta name="format-detection" content="telephone=no" />
  <meta name="msapplication-tap-highlight" content="no" />
  <meta name="robots" content="noindex" />
  <link rel="shortcut icon" href="../../../assets/img/LogoIPSI.png" />
  <link rel="stylesheet prefetch" href="../../../assets/bootstrap/dist/css/bootstrap.min.css" />
  <style>
    /* RESET & BASE */
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
      height: 100vh;
      overflow: hidden;
      font-family: 'Segoe UI', system-ui, -apple-system, sans-serif;
      color: #e6e6e6;
    }

    .container-fluid {
      height: 100vh;
      padding: 10px;
    }

    /* HEADER */
    .header-bar {
      backdrop-filter: blur(10px);
      border-radius: 15px;
      padding: 15px 20px;
      margin-bottom: 15px;
      margin-top: 15px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
    }

    .player-info {
      flex: 1;
    }

    .player-name {
      font-size: 22px;
      font-weight: 800;
      color: #00e5ff;
      text-shadow: 0 0 10px rgba(0, 229, 255, 0.5);
      margin-bottom: 5px;
    }

    .player-details {
      font-size: 13px;
      color: #fff;
      display: flex;
      gap: 15px;
      flex-wrap: wrap;
    }

    .status-badge {
      display: inline-block;
      padding: 4px 12px;
      border-radius: 20px;
      font-size: 12px;
      font-weight: 700;
      background: #2d3748;
      color: #cbd5e0;
    }

    .status-active {
      background: linear-gradient(135deg, #00b09b, #96c93d);
      color: white;
    }

    /* TIMER SECTION */
    .timer-section {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 8px;
    }

    .timer-display {
      font-family: 'Courier New', monospace;
      font-size: 32px;
      font-weight: 900;
      color: #00e5ff;
      text-shadow: 0 0 20px rgba(0, 229, 255, 0.8);
      background: rgba(0, 0, 0, 0.6);
      padding: 10px 25px;
      margin-top: 20px;
      border-radius: 12px;
      border: 3px solid rgba(0, 229, 255, 0.4);
      letter-spacing: 2px;
      box-shadow: 0 0 20px rgba(0, 229, 255, 0.2);
    }

    .control-buttons {
      display: flex;
      gap: 8px;
    }

    .control-btn {
      padding: 6px 12px;
      border-radius: 8px;
      font-size: 12px;
      font-weight: 600;
      border: none;
      background: rgba(255, 255, 255, 0.1);
      color: white;
      transition: all 0.2s ease;
      cursor: pointer;
      display: flex;
      align-items: center;
      gap: 5px;
    }

    .control-btn:hover {
      background: rgba(255, 255, 255, 0.2);
      transform: translateY(-1px);
    }

    .btn-danger {
      background: linear-gradient(135deg, #dc3545, #c82333);
    }

    .btn-light {
      background: rgba(255, 255, 255, 0.9);
      color: #1a1a2e;
    }

    /* MAIN CONTENT - THREE COLUMN GRID */
    .main-content {
      display: grid;
      grid-template-columns: 0.8fr 1.2fr 0.8fr;
      gap: 15px;
      height: calc(100vh - 140px);
    }

    /* PENALTY SECTION */
    .penalty-column {
      background: rgba(255, 255, 255, 0.05);
      backdrop-filter: blur(10px);
      border-radius: 15px;
      padding: 20px;
      border: 1px solid rgba(255, 255, 255, 0.1);
      display: flex;
      flex-direction: column;
      gap: 12px;
      overflow-y: auto;
    }

    .penalty-column::-webkit-scrollbar {
      width: 5px;
    }

    .penalty-column::-webkit-scrollbar-track {
      background: rgba(0, 0, 0, 0.2);
      border-radius: 3px;
    }

    .penalty-column::-webkit-scrollbar-thumb {
      background: #00e5ff;
      border-radius: 3px;
    }

    .penalty-item {
      background: rgba(255, 255, 255, 0.08);
      border-radius: 12px;
      padding: 15px;
      margin-bottom: 10px;
      border: 1px solid rgba(255, 255, 255, 0.1);
      transition: all 0.3s ease;
    }

    .penalty-item:hover {
      background: rgba(255, 255, 255, 0.12);
      border-color: rgba(0, 229, 255, 0.3);
    }

    .penalty-item.active {
      background: linear-gradient(135deg, rgba(220, 53, 69, 0.2), rgba(200, 35, 51, 0.2));
      border: 2px solid #dc3545;
      box-shadow: 0 0 15px rgba(220, 53, 69, 0.3);
    }

    .penalty-item.active .penalty-title {
      color: #ff8a8a;
      font-weight: 700;
    }

    .penalty-item.active .penalty-score {
      border-color: #ff8a8a;
      color: #ff8a8a;
      animation: glow 1.5s ease-in-out infinite alternate;
    }

    .penalty-title {
      font-size: 14px;
      font-weight: 600;
      color: #e2e8f0;
      margin-bottom: 12px;
      line-height: 1.3;
      display: flex;
      align-items: center;
      flex-wrap: wrap;
      gap: 8px;
    }

    .penalty-badge {
      display: inline-block;
      padding: 3px 8px;
      border-radius: 12px;
      font-size: 10px;
      font-weight: 700;
      text-transform: uppercase;
      letter-spacing: 0.5px;
      background: linear-gradient(135deg, #dc3545, #c82333);
      color: white;
      animation: pulse 2s infinite;
    }

    .penalty-indicator {
      margin-top: 10px;
      padding: 8px 12px;
      border-radius: 6px;
      font-size: 12px;
      font-weight: 600;
      background: rgba(220, 53, 69, 0.15);
      border: 1px solid rgba(220, 53, 69, 0.3);
      color: #ff6b6b;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .penalty-indicator i {
      font-size: 14px;
      color: #dc3545;
    }

    .penalty-indicator .penalty-value {
      font-weight: 700;
      color: #dc3545;
      font-size: 14px;
      margin-left: 5px;
    }

    .penalty-controls {
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 10px;
    }

    .penalty-score {
      font-size: 24px;
      font-weight: 900;
      color: #dc3545;
      min-width: 70px;
      text-align: center;
      padding: 8px;
      background: rgba(0, 0, 0, 0.3);
      border-radius: 8px;
      border: 2px solid #dc3545;
    }

    .penalty-buttons {
      display: flex;
      gap: 8px;
    }

    .btn-penalty {
      padding: 8px 16px;
      border-radius: 8px;
      font-size: 13px;
      font-weight: 600;
      border: none;
      cursor: pointer;
      transition: all 0.2s ease;
      display: flex;
      align-items: center;
      gap: 5px;
    }

    .btn-clear {
      background: linear-gradient(135deg, #4299e1, #3182ce);
      color: white;
    }

    .btn-minus {
      background: linear-gradient(135deg, #f56565, #e53e3e);
      color: white;
    }

    .btn-penalty:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
    }

    /* BROADCAST COLUMN */
    .broadcast-column {
      background: rgba(255, 255, 255, 0.05);
      backdrop-filter: blur(10px);
      border-radius: 15px;
      padding: 20px;
      border: 1px solid rgba(255, 255, 255, 0.1);
      display: flex;
      flex-direction: column;
      gap: 20px;
      overflow-y: auto;
    }

    .broadcast-column::-webkit-scrollbar {
      width: 5px;
    }

    .broadcast-column::-webkit-scrollbar-track {
      background: rgba(0, 0, 0, 0.2);
      border-radius: 3px;
    }

    .broadcast-column::-webkit-scrollbar-thumb {
      background: #00e5ff;
      border-radius: 3px;
    }

    .broadcast-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 5px;
      padding-bottom: 5px;
      border-bottom: 2px solid rgba(0, 229, 255, 0.3);
    }

    .broadcast-header h3 {
      font-size: 18px;
      font-weight: 700;
      color: #00e5ff;
      margin: 0;
    }

    .broadcast-badge {
      background: rgba(0, 229, 255, 0.2);
      color: #00e5ff;
      padding: 5px 10px;
      border-radius: 20px;
      font-size: 12px;
      font-weight: 600;
    }

    .broadcast-card {
      background: rgba(255, 255, 255, 0.08);
      border-radius: 12px;
      padding: 15px;
      margin-bottom: 15px;
      border: 1px solid rgba(255, 255, 255, 0.1);
    }

    .broadcast-card.biru {
      border-left: 5px solid #00e5ff;
    }

    .broadcast-card.merah {
      border-left: 5px solid #ff4757;
    }

    .broadcast-sudut {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 15px;
    }

    .sudut-label-badge {
      padding: 4px 12px;
      border-radius: 20px;
      font-size: 12px;
      font-weight: 700;
      text-transform: uppercase;
    }

    .sudut-label-badge.biru {
      background: rgba(0, 229, 255, 0.2);
      color: #00e5ff;
    }

    .sudut-label-badge.merah {
      background: rgba(255, 71, 87, 0.2);
      color: #fff;
    }

    .broadcast-total {
      font-size: 15px;
      font-weight: 900;
      color: #ffd700;
      text-shadow: 0 0 15px rgba(255, 215, 0, 0.5);
      background: rgba(0, 0, 0, 0.3);
      padding: 5px 15px;
      border-radius: 10px;
      border: 1px solid rgba(255, 215, 0, 0.3);
    }

    .stats-container {
      display: flex;
      gap: 10px;
      margin-bottom: 15px;
    }

    .stat-item {
      flex: 1;
      text-align: center;
      padding: 8px;
      background: rgba(0, 0, 0, 0.3);
      border-radius: 8px;
      border: 1px solid rgba(255, 255, 255, 0.1);
    }

    .stat-label {
      font-size: 10px;
      color: #a0aec0;
      text-transform: uppercase;
      letter-spacing: 1px;
      margin-bottom: 5px;
    }

    .stat-value {
      font-size: 15px;
      font-weight: 700;
      color: #a78bfa;
      font-family: 'Courier New', monospace;
    }

    .stat-value.deviation {
      color: #ffd700;
    }

    .broadcast-table {
      width: 100%;
      border-collapse: collapse;
      margin: 10px 0;
      font-size: 12px;
    }

    .broadcast-table th {
      background: rgba(0, 0, 0, 0.3);
      color: #a0aec0;
      font-weight: 600;
      padding: 8px;
      text-align: left;
      border-bottom: 1px solid rgba(255, 255, 255, 0.1);
    }

    .broadcast-table td {
      padding: 8px;
      border-bottom: 1px solid rgba(255, 255, 255, 0.05);
      color: #e2e8f0;
    }

    .broadcast-table tr:hover {
      background: rgba(255, 255, 255, 0.05);
    }

    .badge-wrong {
      background: rgba(220, 53, 69, 0.2);
      color: #fff;
      padding: 2px 8px;
      border-radius: 12px;
      font-size: 12px;
    }

    .badge-stamina {
      background: rgba(72, 187, 120, 0.2);
      color: #48bb78;
      padding: 2px 8px;
      border-radius: 12px;
      font-size: 12px;
    }

    .badge-total {
      background: rgba(0, 229, 255, 0.2);
      color: #00e5ff;
      padding: 2px 8px;
      border-radius: 12px;
      font-size: 12px;
      font-weight: 700;
    }

    .penalty-summary {
      background: rgba(255, 193, 7, 0.1);
      border-radius: 8px;
      padding: 10px;
      margin-top: 10px;
      font-size: 12px;
      color: #ffd700;
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .penalty-summary .title {
      color: #a0aec0;
    }

    /* SUMMARY COLUMN */
    .summary-column {
      background: rgba(255, 255, 255, 0.05);
      backdrop-filter: blur(10px);
      border-radius: 15px;
      padding: 20px;
      border: 1px solid rgba(255, 255, 255, 0.1);
      display: flex;
      flex-direction: column;
      gap: 20px;
    }

    .total-box {
      background: linear-gradient(135deg, rgba(220, 53, 69, 0.2), rgba(255, 71, 87, 0.2));
      border-radius: 15px;
      padding: 30px;
      text-align: center;
      border: 2px solid rgba(220, 53, 69, 0.3);
      flex: 1;
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
    }

    .total-label {
      font-size: 14px;
      text-transform: uppercase;
      letter-spacing: 2px;
      color: #ff6b6b;
      margin-bottom: 15px;
    }

    .total-label h1 {
      font-size: 18px;
      margin: 0;
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .total-label span {
      font-size: 12px;
      background: #dc3545;
      color: white;
      padding: 2px 8px;
      border-radius: 12px;
    }

    .total-value {
      font-size: 56px;
      font-weight: 900;
      color: #dc3545;
      text-shadow: 0 0 20px rgba(220, 53, 69, 0.5);
    }

    .total-value h1 {
      font-size: 56px;
      margin: 0;
    }

    .action-buttons {
      display: flex;
      flex-direction: column;
      gap: 12px;
    }

    .btn-action {
      padding: 16px;
      border-radius: 12px;
      font-size: 16px;
      font-weight: 700;
      border: none;
      cursor: pointer;
      transition: all 0.3s ease;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 10px;
      text-transform: uppercase;
      letter-spacing: 1px;
    }

    .btn-selesai {
      background: linear-gradient(135deg, #48bb78, #38a169);
      color: white;
    }

    .btn-finish {
      background: linear-gradient(135deg, #805ad5, #6b46c1);
      color: white;
    }

    .btn-winner-biru {
      background: linear-gradient(135deg, #00e5ff, #4299e1);
      color: white;
    }

    .btn-winner-merah {
      background: linear-gradient(135deg, #ff4757, #ff6b81);
      color: white;
    }

    .btn-action:hover {
      transform: translateY(-3px);
      box-shadow: 0 8px 25px rgba(0, 0, 0, 0.4);
    }

    .btn-action:disabled {
      opacity: 0.5;
      cursor: not-allowed;
      transform: none;
    }

    /* MODAL STYLES */
    .modal-content {
      border-radius: 15px;
      overflow: hidden;
      border: none;
      box-shadow: 0 15px 50px rgba(0, 0, 0, 0.5);
      background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
      color: #e6e6e6;
    }

    .modal-header {
      border-bottom: 1px solid rgba(255, 255, 255, 0.1);
    }

    .modal-title {
      color: #00e5ff;
      font-weight: 800;
    }

    .btn-close-white {
      filter: invert(1) grayscale(100%) brightness(200%);
    }

    .result-container {
      padding: 20px;
    }

    .sudut-section {
      background: rgba(255, 255, 255, 0.05);
      border-radius: 12px;
      padding: 20px;
      margin-bottom: 20px;
      border: 2px solid transparent;
      transition: all 0.3s ease;
    }

    .sudut-section.winner {
      transform: scale(1.02);
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
    }

    .biru-section {
      border-color: #00e5ff;
      background: linear-gradient(135deg, rgba(0, 229, 255, 0.05), rgba(66, 153, 225, 0.05));
    }

    .merah-section {
      border-color: #ff4757;
      background: linear-gradient(135deg, rgba(255, 71, 87, 0.05), rgba(255, 107, 129, 0.05));
    }

    .sudut-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 15px;
      padding-bottom: 10px;
      border-bottom: 1px solid rgba(255, 255, 255, 0.1);
    }

    .sudut-label {
      padding: 8px 16px;
      border-radius: 8px;
      font-weight: 700;
      text-transform: uppercase;
      letter-spacing: 1px;
      font-size: 14px;
    }

    .sudut-label.biru {
      background: linear-gradient(135deg, #00e5ff, #4299e1);
      color: white;
    }

    .sudut-label.merah {
      background: linear-gradient(135deg, #ff4757, #ff6b81);
      color: white;
    }

    .total-nilai {
      font-size: 32px;
      font-weight: 900;
      font-family: 'Courier New', monospace;
      color: #00e5ff;
      text-shadow: 0 0 10px rgba(0, 229, 255, 0.5);
    }

    .sudut-info {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 15px;
    }

    .info-item {
      display: flex;
      flex-direction: column;
      gap: 5px;
    }

    .info-item .label {
      font-size: 12px;
      color: #a0aec0;
      text-transform: uppercase;
      letter-spacing: 1px;
    }

    .info-item .value {
      font-size: 16px;
      font-weight: 600;
      color: #e2e8f0;
    }

    /* WINNER SECTION */
    .winner-section {
      text-align: center;
      padding: 30px;
      background: linear-gradient(135deg, rgba(255, 215, 0, 0.1), rgba(255, 193, 7, 0.1));
      border-radius: 12px;
      margin-top: 20px;
      border: 2px dashed rgba(255, 215, 0, 0.5);
    }

    .winner-trophy {
      font-size: 48px;
      color: #ffd700;
      margin-bottom: 15px;
      animation: bounce 2s infinite;
    }

    @keyframes bounce {

      0%,
      100% {
        transform: translateY(0);
      }

      50% {
        transform: translateY(-10px);
      }
    }

    .winner-name {
      font-size: 24px;
      font-weight: 800;
      color: #ffd700;
      margin-bottom: 10px;
      text-shadow: 0 0 10px rgba(255, 215, 0, 0.5);
    }

    .winner-score {
      font-size: 36px;
      font-weight: 900;
      color: #ffd700;
      font-family: 'Courier New', monospace;
      margin-bottom: 10px;
    }

    .winner-kontingen {
      font-size: 16px;
      color: #e2e8f0;
      opacity: 0.8;
    }

    /* ANIMATIONS */
    @keyframes pulse {
      0% {
        transform: scale(1);
        opacity: 1;
      }

      50% {
        transform: scale(1.05);
        opacity: 0.8;
      }

      100% {
        transform: scale(1);
        opacity: 1;
      }
    }

    @keyframes glow {
      from {
        box-shadow: 0 0 5px rgba(220, 53, 69, 0.5);
      }

      to {
        box-shadow: 0 0 15px rgba(220, 53, 69, 0.8);
      }
    }

    @keyframes fadeIn {
      from {
        opacity: 0;
        transform: translateY(10px);
      }

      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    .fade-in {
      animation: fadeIn 0.5s ease;
    }

    .pulse {
      animation: pulse 0.5s ease;
    }

    /* NOTIFICATION */
    #custom-notification {
      position: fixed;
      top: 20px;
      right: 20px;
      padding: 15px 25px;
      border-radius: 10px;
      color: white;
      font-weight: bold;
      z-index: 99999;
      box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
      animation: slideIn 0.3s ease-out, fadeOut 0.3s ease-in 2.5s forwards;
      display: flex;
      align-items: center;
      gap: 10px;
    }

    @keyframes slideIn {
      from {
        transform: translateX(100%);
        opacity: 0;
      }

      to {
        transform: translateX(0);
        opacity: 1;
      }
    }

    @keyframes fadeOut {
      from {
        opacity: 1;
      }

      to {
        opacity: 0;
      }
    }

    /* RESPONSIVE */
    @media (max-width: 1024px) {
      .main-content {
        grid-template-columns: 1fr;
        height: calc(100vh - 160px);
      }

      .penalty-column {
        max-height: 40vh;
      }

      .broadcast-column {
        max-height: 40vh;
      }
    }

    @media (max-width: 768px) {
      .header-bar {
        flex-direction: column;
        gap: 15px;
        text-align: center;
      }

      .timer-display {
        font-size: 28px;
        padding: 8px 20px;
      }

      .total-value {
        font-size: 48px;
      }

      .btn-penalty {
        padding: 6px 12px;
        font-size: 12px;
      }

      .stats-container {
        flex-direction: column;
      }

      .sudut-header {
        flex-direction: column;
        gap: 10px;
        text-align: center;
      }

      .total-nilai {
        font-size: 24px;
      }

      .sudut-info {
        grid-template-columns: 1fr;
      }
    }

    /* FULLSCREEN ICONS */
    #openfull,
    #exitfull {
      background: rgba(255, 255, 255, 0.1);
      border: 1px solid rgba(255, 255, 255, 0.2);
      border-radius: 6px;
      padding: 8px;
      width: 36px;
      height: 36px;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
    }

    #openfull svg,
    #exitfull svg {
      fill: white;
    }
  </style>

  <title>DEWAN SENI</title>
</head>

<body>
  <div class="container-fluid fade-in">
    <!-- HEADER -->
    <div class="header-bar bg-dark bg-gradient fade-in">
      <!-- LEFT SECTION - Player Info -->
      <div class="player-info">
        <div class="player-name d-flex align-items-center">
          <i class="fas fa-user-circle me-2" style="color: #00e5ff;"></i>
          <span class="nm">-</span>
        </div>
        <div class="player-details d-flex flex-wrap align-items-center gap-2 mt-2">
          <span class="badge bg-info text-dark"><i class="fas fa-flag me-1"></i> <span class="kontingen">-</span></span>
          <span class="badge bg-secondary text-dark"><i class="fas fa-tag me-1"></i> <span
              class="kategori">-</span>/<span class="kelas">-</span></span>
          <span class="badge bg-primary text-dark"><i class="fas fa-hashtag me-1"></i> PARTAI <span
              id="current-partai">-</span></span>
          <span class="badge" style="background: #00e5ff; color: #1a1a2e;" id="current-sudut-badge">
            <i class="fas fa-arrow-right me-1"></i> <span id="current-sudut">-</span>
          </span>
        </div>
      </div>

      <!-- RIGHT SECTION - Timer & Controls -->
      <div class="d-flex align-items-center gap-4">
        <!-- Timer with icon -->
        <div class="timer-wrapper d-flex align-items-center">
          <div id="timer" class="timer-display">02:00</div>
        </div>

        <!-- Separator -->
        <div class="vr text-white-50" style="height: 100px;"></div>

        <!-- Control buttons -->
        <div class="d-flex align-items-center gap-2">
          <!-- Fullscreen toggles - digabung dalam satu grup -->
          <div class="btn-group" role="group">
            <button aria-label="Open Fullscreen" id="openfull" onclick="openFullscreen();" class="control-btn"
              title="Fullscreen">
              <i class="fas fa-expand"></i>
            </button>
            <button aria-label="Exit Fullscreen" id="exitfull" onclick="closeFullscreen();" class="control-btn d-none"
              title="Exit Fullscreen">
              <i class="fas fa-compress"></i>
            </button>
          </div>

          <!-- Action buttons dengan warna konsisten -->
          <button class="control-btn btn-danger" onclick="konfirmasiKeluar()" title="Keluar">
            <i class="fas fa-sign-out-alt me-1"></i> EXIT
          </button>
          <a href="#" class="control-btn btn-light" onclick="konfirmasiRefresh(event)" style="text-decoration: none;"
            title="Refresh">
            <i class="fas fa-sync-alt me-1"></i> REFRESH
          </a>
        </div>
      </div>
    </div>

    <!-- MAIN CONTENT - THREE COLUMN GRID -->
    <div class="main-content">
      <!-- PENALTY COLUMN -->
      <div class="penalty-column">
        <!-- Penalty 1 -->
        <div class="penalty-item" id="penalty-1">
          <div class="penalty-title">
            1. Performanya Melampaui Arena 10m x 10m
            <span class="penalty-badge" id="penalty-badge-1" style="display: none;">
              <i class="fas fa-exclamation-triangle"></i> PENALTY
            </span>
          </div>
          <div class="penalty-controls">
            <div class="penalty-buttons">
              <button class="btn-penalty btn-clear" data-target="1">
                <i class="fas fa-check"></i> CLEAR
              </button>
              <button class="btn-penalty btn-minus" data-target="1">
                <i class="fas fa-minus"></i> -0.50
              </button>
            </div>
            <div class="penalty-score target1">0.00</div>
          </div>
        </div>

        <!-- Penalty 2 -->
        <div class="penalty-item" id="penalty-2">
          <div class="penalty-title">
            2. Menjatuh Kan Senjata Dan Memegang Matras
            <span class="penalty-badge" id="penalty-badge-2" style="display: none;">
              <i class="fas fa-exclamation-triangle"></i> PENALTY
            </span>
          </div>
          <div class="penalty-controls">
            <div class="penalty-buttons">
              <button class="btn-penalty btn-clear" data-target="2">
                <i class="fas fa-check"></i> CLEAR
              </button>
              <button class="btn-penalty btn-minus" data-target="2">
                <i class="fas fa-minus"></i> -0.50
              </button>
            </div>
            <div class="penalty-score target2">0.00</div>
          </div>
        </div>

        <!-- Penalty 3 -->
        <div class="penalty-item" id="penalty-3">
          <div class="penalty-title">
            3. Pakaian Tidak Sesuai Dengan Aturan (Tanjak atau Samping lepas)
            <span class="penalty-badge" id="penalty-badge-3" style="display: none;">
              <i class="fas fa-exclamation-triangle"></i> PENALTY
            </span>
          </div>
          <div class="penalty-controls">
            <div class="penalty-buttons">
              <button class="btn-penalty btn-clear" data-target="3">
                <i class="fas fa-check"></i> CLEAR
              </button>
              <button class="btn-penalty btn-minus" data-target="3">
                <i class="fas fa-minus"></i> -0.50
              </button>
            </div>
            <div class="penalty-score target3">0.00</div>
          </div>
          <!-- <div class="penalty-indicator" id="penalty-indicator-3" style="display: none;">
            <i class="fas fa-exclamation-circle"></i> Penalty aktif: <span class="penalty-value"
              id="penalty-value-3">0.00</span>
          </div> -->
        </div>

        <!-- Penalty 4 -->
        <div class="penalty-item" id="penalty-4">
          <div class="penalty-title">
            4. Atlet Bertahan Pada Satu Gerakan Selama Lebih Dari 5 Detik
            <span class="penalty-badge" id="penalty-badge-4" style="display: none;">
              <i class="fas fa-exclamation-triangle"></i> PENALTY
            </span>
          </div>
          <div class="penalty-controls">
            <div class="penalty-buttons">
              <button class="btn-penalty btn-clear" data-target="4">
                <i class="fas fa-check"></i> CLEAR
              </button>
              <button class="btn-penalty btn-minus" data-target="4">
                <i class="fas fa-minus"></i> -0.50
              </button>
            </div>
            <div class="penalty-score target4">0.00</div>
          </div>
          <!-- <div class="penalty-indicator" id="penalty-indicator-4" style="display: none;">
            <i class="fas fa-exclamation-circle"></i> Penalty aktif: <span class="penalty-value"
              id="penalty-value-4">0.00</span>
          </div> -->
        </div>

        <!-- Penalty 5 -->
        <div class="penalty-item" id="penalty-5">
          <div class="penalty-title">
            5. Waktu Penampilan +/- <span style="font-size: 12px; color: #a0aec0;">(berulang)</span>
            <span class="penalty-badge" id="penalty-badge-5" style="display: none;">
              <i class="fas fa-exclamation-triangle"></i> PENALTY
            </span>
          </div>
          <div class="penalty-controls">
            <div class="penalty-buttons">
              <button class="btn-penalty btn-clear" data-target="5">
                <i class="fas fa-check"></i> CLEAR
              </button>
              <button class="btn-penalty btn-minus" data-target="5">
                <i class="fas fa-minus"></i> -0.50
              </button>
            </div>
            <div class="penalty-score target5">0.00</div>
          </div>
          <!-- <div class="penalty-indicator" id="penalty-indicator-5" style="display: none;">
            <i class="fas fa-exclamation-circle"></i> Penalty aktif: <span class="penalty-value"
              id="penalty-value-5">0.00</span>
          </div> -->
        </div>
      </div>

      <!-- BROADCAST COLUMN -->
      <div class="broadcast-column">

        <!-- Biru Broadcast Card -->
        <div class="broadcast-card biru" id="broadcast-biru" style="display: none;">
          <div class="broadcast-sudut">
            <span class="sudut-label-badge biru"><i class="fas fa-user me-1"></i>BIRU</span>
            <span class="broadcast-total" id="broadcast-total-biru">0.00</span>
          </div>

          <div class="stats-container">
            <div class="stat-item">
              <div class="stat-label">MEDIAN</div>
              <div class="stat-value" id="broadcast-median-biru">0.000</div>
            </div>
            <div class="stat-item">
              <div class="stat-label">PENALTY</div>
              <span id="broadcast-penalty-value-biru">0.00</span>
            </div>
            <div class="stat-item">
              <div class="stat-label">DEVIASI</div>
              <div class="stat-value deviation" id="broadcast-stddev-biru">0.000000</div>
            </div>
          </div>

          <table class="broadcast-table">
            <thead>
              <tr>
                <th>Juri</th>
                <th>Wrong</th>
                <th>Stamina</th>
                <th>Total</th>
              </tr>
            </thead>
            <tbody id="broadcast-table-biru"></tbody>
          </table>
        </div>

        <!-- Merah Broadcast Card -->
        <div class="broadcast-card merah" id="broadcast-merah" style="display: none;">
          <div class="broadcast-sudut">
            <span class="sudut-label-badge merah"><i class="fas fa-user me-1"></i>MERAH</span>
            <span class="broadcast-total" id="broadcast-total-merah">0.00</span>
          </div>

          <div class="stats-container">
            <div class="stat-item">
              <div class="stat-label">MEDIAN</div>
              <div class="stat-value" id="broadcast-median-merah">0.000</div>
            </div>
            <div class="stat-item">
              <div class="stat-label">PENALTY</div>
              <span id="broadcast-penalty-value-merah">0.00</span>
            </div>
            <div class="stat-item">
              <div class="stat-label">DEVIASI</div>
              <div class="stat-value deviation" id="broadcast-stddev-merah">0.000000</div>
            </div>
          </div>

          <table class="broadcast-table">
            <thead>
              <tr>
                <th>Juri</th>
                <th>Wrong</th>
                <th>Stamina</th>
                <th>Total</th>
              </tr>
            </thead>
            <tbody id="broadcast-table-merah"></tbody>
          </table>
        </div>

        <div class="text-center text-muted small" id="broadcast-empty" style="display: none;">
          <i class="fas fa-info-circle me-1"></i>Belum ada data broadcast
        </div>
      </div>

      <!-- SUMMARY COLUMN -->
      <div class="summary-column">

        <div class="action-buttons">
          <button class="btn-action btn-winner-biru" id="winner-biru-btn" onclick="declareWinner('BIRU')" disabled>
            <i class="fas fa-crown me-2"></i> WINNER BIRU
          </button>
          <button class="btn-action btn-winner-merah" id="winner-merah-btn" onclick="declareWinner('MERAH')" disabled>
            <i class="fas fa-crown me-2"></i> WINNER MERAH
          </button>
          <button class="btn-action btn-selesai selesai_seni">
            <i class="fas fa-flag-checkered"></i> SELESAI PENILAIAN
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- MODAL HASIL PARTAI -->
  <div class="modal fade" id="resultModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-lg modal-dialog-centered">
      <div class="modal-content">
        <div class="modal-header" style="background: linear-gradient(135deg, #1a1a2e, #16213e); color: white;">
          <h4 class="modal-title fw-bold">
            <i class="fas fa-trophy me-2"></i>HASIL PARTAI</span>
          </h4>
          <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
        </div>

        <div class="modal-body p-0">
          <div class="result-container">
            <!-- Biru Section -->
            <div class="sudut-section biru-section">
              <div class="sudut-header">
                <div class="sudut-label biru">
                  <i class="fas fa-user me-2"></i>SUDUT BIRU
                </div>
                <div class="total-nilai" id="total-biru">0.00</div>
              </div>
            </div>

            <!-- Merah Section -->
            <div class="sudut-section merah-section">
              <div class="sudut-header">
                <div class="sudut-label merah">
                  <i class="fas fa-user me-2"></i>SUDUT MERAH
                </div>
                <div class="total-nilai" id="total-merah">0.00</div>
              </div>
            </div>

            <!-- Pemenang Section -->
            <div class="winner-section" id="winner-section">
              <div class="winner-trophy">
                <i class="fas fa-trophy"></i>
              </div>
              <div class="winner-name" id="winner-name">MENUNGGU HASIL</div>
              <div class="winner-score" id="winner-score">0.00</div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <script type="text/javascript" src="../../../assets/jquery/jquery.min.js"></script>
  <script type="text/javascript" src="../../../assets/bootstrap/dist/js/bootstrap.bundle.min.js"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

  <script>
    // ======== KONSTANTA & VAR GLOBAL ========
    const hostname = window.location.hostname;
    let ws;
    let currentPartaiData = null;
    let lastResultData = null;
    let broadcastData = null;

    // INISIALISASI
    $(document).ready(function () {
      initializeApp();
    });

    function initializeApp() {
      if (localStorage.getItem('is_login') < 1) {
        localStorage.clear();
        document.location.href = "http://" + hostname + "/DARUNNAJAH/TGR/tunggal/dewan";
        return;
      }

      initWebSocket();
      setupEventListeners();
      loadInitialData();
    }

    function initWebSocket() {
      ws = new WebSocket('ws://' + hostname + ':3000');

      ws.onopen = function () {
        console.log('âœ… WebSocket connected');
        if (localStorage.getItem('partai')) {
          ws.send(JSON.stringify({
            type: 'getNilaiSeniAll',
            partai: localStorage.getItem('partai')
          }));
        }
      };

      ws.onmessage = handleWebSocketMessage;
      ws.onclose = () => setTimeout(initWebSocket, 3000);
    }

    function setupEventListeners() {
      $(document).on('click', '.btn-clear', function () {
        const target = $(this).data('target');
        handlePenalty(target, 'clear');
      });

      $(document).on('click', '.btn-minus', function () {
        const target = $(this).data('target');
        handlePenalty(target, 'add');
      });

      $('.selesai_seni').on('click', handleSelesaiSeni);
    }

    function loadInitialData() {
      const dataString = localStorage.getItem('currentPartai');
      if (dataString) {
        try {
          currentPartaiData = JSON.parse(dataString);
          updateDisplay(currentPartaiData);
        } catch (e) {
          console.error("Error parsing data:", e);
        }
      }
    }

    // ======== FUNGSI STATISTIK ========
    function calculateMedian(values) {
      if (!values || values.length === 0) return 0;
      const sorted = [...values].sort((a, b) => a - b);
      const mid = Math.floor(sorted.length / 2);
      return sorted.length % 2 === 0 ? (sorted[mid - 1] + sorted[mid]) / 2 : sorted[mid];
    }

    function calculateStdDev(values) {
      if (!values || values.length === 0) return 0;
      const mean = values.reduce((a, b) => a + b, 0) / values.length;
      const variance = values.map(v => Math.pow(v - mean, 2)).reduce((a, b) => a + b, 0) / values.length;
      return Math.sqrt(variance);
    }

    // ======== FUNGSI PENALTY - UPDATE FROM BROADCAST ========
    function getPenaltyKey(partai, sudut) {
      return `penalty_${partai}_${sudut}`;
    }

    // UPDATE PENALTY UI DARI BROADCAST DATA
    function updatePenaltyFromBroadcast() {
      if (!broadcastData || !currentPartaiData) return;

      const currentSudut = currentPartaiData.peserta?.sudut;
      if (!currentSudut) return;

      // RESET TAMPILAN DULU
      for (let i = 1; i <= 5; i++) {
        $(`.target${i}`).text('0.00');
        $(`#penalty-${i}`).removeClass('active');
        $(`#penalty-badge-${i}`).hide();
        $(`#penalty-indicator-${i}`).hide();
      }

      const penalty = broadcastData.penalties?.find(p => p.sudut === currentSudut);

      if (penalty && penalty.detail) {
        const key = getPenaltyKey(currentPartaiData.partai, currentSudut);
        localStorage.setItem(key, JSON.stringify(penalty.detail));

        // Update UI dengan data baru
        let total = 0;
        let activeCount = 0;

        for (let i = 1; i <= 5; i++) {
          const score = penalty.detail[`hukum_${i}`] || 0;
          $(`.target${i}`).text(score.toFixed(2));

          if (score !== 0) {
            $(`#penalty-${i}`).addClass('active');
            $(`#penalty-badge-${i}`).show();
            $(`#penalty-indicator-${i}`).show();
            $(`#penalty-value-${i}`).text(score.toFixed(2));
            total += score;
            activeCount++;
          }
        }
      }
    }

    function handlePenalty(target, action) {
      if (!currentPartaiData) return;

      const key = getPenaltyKey(currentPartaiData.partai, currentPartaiData.peserta.sudut);
      let penaltyData = JSON.parse(localStorage.getItem(key) || '{}');

      if (action === 'add') {
        if (target == 5) {
          penaltyData[target] = (penaltyData[target] || 0) - 0.5;
        } else {
          penaltyData[target] = -0.5;
        }
      } else { // clear
        if (target == 5 && penaltyData[target] < 0) {
          penaltyData[target] = Math.min(0, (penaltyData[target] || 0) + 0.5);
          if (penaltyData[target] === 0) delete penaltyData[target];
        } else {
          delete penaltyData[target];
        }
      }

      localStorage.setItem(key, JSON.stringify(penaltyData));

      // Update UI
      for (let i = 1; i <= 5; i++) {
        const score = penaltyData[i] || 0;
        $(`.target${i}`).text(score.toFixed(2));

        if (score !== 0) {
          $(`#penalty-${i}`).addClass('active');
          $(`#penalty-badge-${i}`).show();
          $(`#penalty-indicator-${i}`).show();
          $(`#penalty-value-${i}`).text(score.toFixed(2));
        } else {
          $(`#penalty-${i}`).removeClass('active');
          $(`#penalty-badge-${i}`).hide();
          $(`#penalty-indicator-${i}`).hide();
        }
      }

      // Hitung total
      const total = Object.values(penaltyData).reduce((a, b) => a + (b || 0), 0);
      const activeCount = Object.values(penaltyData).filter(v => v !== 0).length;

      // Kirim ke server
      ws.send(JSON.stringify({
        type: action === 'add' ? 'penalty_add_tunggal' : 'penalty_remove_tunggal',
        partai: currentPartaiData.partai,
        sudut: currentPartaiData.peserta.sudut,
        target: target,
        score: penaltyData[target] || 0
      }));
    }

    // ======== FUNGSI BROADCAST ========
    function updateBroadcastDisplay(data) {
      if (!data) {
        $('#broadcast-biru, #broadcast-merah').hide();
        $('#broadcast-empty').show();
        return;
      }

      broadcastData = data;
      $('#broadcast-empty').hide();
      $('#broadcast-partai').text(`Partai ${data.partai || '-'}`);

      // Update Biru
      if (data.rekap_per_sudut && data.rekap_per_sudut.BIRU) {
        updateSudutBroadcast('BIRU', data.rekap_per_sudut.BIRU, data.penalties);
      } else {
        $('#broadcast-biru').hide();
      }

      // Update Merah
      if (data.rekap_per_sudut && data.rekap_per_sudut.MERAH) {
        updateSudutBroadcast('MERAH', data.rekap_per_sudut.MERAH, data.penalties);
      } else {
        $('#broadcast-merah').hide();
      }

      // Update penalty untuk sudut yang aktif
      updatePenaltyFromBroadcast();

      // Aktifkan tombol winner jika kedua sudut sudah memiliki data
      if (data.rekap_per_sudut?.BIRU && data.rekap_per_sudut?.MERAH) {
        $('#winner-biru-btn, #winner-merah-btn').prop('disabled', false);
      }
    }

    function updateSudutBroadcast(sudut, dataJuri, penalties) {
      const sudutLower = sudut.toLowerCase();
      const tableBody = $(`#broadcast-table-${sudutLower}`);
      const totalEl = $(`#broadcast-total-${sudutLower}`);
      const medianEl = $(`#broadcast-median-${sudutLower}`);
      const stddevEl = $(`#broadcast-stddev-${sudutLower}`);
      const penaltyEl = $(`#broadcast-penalty-${sudutLower}`);
      const penaltyValueEl = $(`#broadcast-penalty-value-${sudutLower}`);

      tableBody.empty();
      const totalValues = [];

      dataJuri.forEach(juri => {
        tableBody.append(`
          <tr>
            <td>Juri ${juri.id_juri}</td>
            <td><span class="badge-wrong">${juri.wrong}</span></td>
            <td><span class="badge-stamina">${juri.stamina.toFixed(2)}</span></td>
            <td><span class="badge-total">${juri.total.toFixed(2)}</span></td>
          </tr>
        `);
        totalValues.push(juri.total);
      });

      const median = calculateMedian(totalValues);
      const stdDev = calculateStdDev(totalValues);
      const total = Math.ceil(median * 100) / 100;

      medianEl.text(median.toFixed(3));
      stddevEl.text(stdDev.toFixed(6));

      const penalty = penalties?.find(p => p.sudut === sudut);
      totalEl.text((median - penalty.total).toFixed(2));
      penaltyValueEl.text(penalty.total.toFixed(2));
      if (penalty && penalty.total > 0) {
        penaltyEl.show();
      } else {
        penaltyEl.hide();
      }

      $(`#broadcast-${sudutLower}`).show();
    }

    // ======== FUNGSI WINNER ========
    function declareWinner(sudut) {
      if (!broadcastData) {
        showNotification('âš ï¸ Tidak ada data penilaian!', 'error');
        return;
      }

      const biruData = broadcastData.rekap_per_sudut?.BIRU || [];
      const merahData = broadcastData.rekap_per_sudut?.MERAH || [];

      if (biruData.length === 0 || merahData.length === 0) {
        showNotification('âš ï¸ Data penilaian belum lengkap!', 'error');
        return;
      }

      const biruMedian = calculateMedian(biruData.map(j => j.total));
      const merahMedian = calculateMedian(merahData.map(j => j.total));

      const biruPenalty = broadcastData.penalties?.find(p => p.sudut === 'BIRU');
      const merahPenalty = broadcastData.penalties?.find(p => p.sudut === 'MERAH');

      const biruFinal = biruMedian - (biruPenalty?.total || 0);
      const merahFinal = merahMedian - (merahPenalty?.total || 0);

      if (sudut === 'BIRU' && biruFinal < merahFinal) {
        if (!confirm(`âš ï¸ PERHATIAN!\nSkor Biru: ${biruFinal.toFixed(2)}\nSkor Merah: ${merahFinal.toFixed(2)}\nTetap pilih BIRU?`)) return;
      }
      if (sudut === 'MERAH' && merahFinal < biruFinal) {
        if (!confirm(`âš ï¸ PERHATIAN!\nSkor Merah: ${merahFinal.toFixed(2)}\nSkor Biru: ${biruFinal.toFixed(2)}\nTetap pilih MERAH?`)) return;
      }

      ws.send(JSON.stringify({
        type: 'winner',
        sudut: sudut,
        currentPartai: { partai: broadcastData.partai, bbk: 'SENI' },
        nilai_biru: biruFinal.toFixed(2),
        nilai_merah: merahFinal.toFixed(2)
      }));

      showNotification(`âœ… Pemenang ${sudut} dideklarasikan`, 'success');
      showResultModal(sudut, biruFinal, merahFinal, biruPenalty?.total || 0, merahPenalty?.total || 0);
    }

    function showResultModal(winner, scoreBiru, scoreMerah, penaltyBiru, penaltyMerah) {
      $('#modal-partai-title').text(`${broadcastData.partai} - ${currentPartaiData?.kategori || ''} ${currentPartaiData?.kelas || ''}`);
      $('#nama-biru').text($('.nm').text());
      $('#kontingen-biru').text($('.kontingen').text());
      $('#penalty-biru').text(penaltyBiru.toFixed(2));
      $('#total-biru').text(scoreBiru.toFixed(2));
      $('#nama-merah').text('-');
      $('#kontingen-merah').text('-');
      $('#penalty-merah').text(penaltyMerah.toFixed(2));
      $('#total-merah').text(scoreMerah.toFixed(2));

      $('.biru-section, .merah-section').removeClass('winner');
      if (winner === 'BIRU') {
        $('.biru-section').addClass('winner');
        $('#winner-name').text('SUDUT BIRU');
        $('#winner-score').text(scoreBiru.toFixed(2));
      } else {
        $('.merah-section').addClass('winner');
        $('#winner-name').text('SUDUT MERAH');
        $('#winner-score').text(scoreMerah.toFixed(2));
      }

      new bootstrap.Modal(document.getElementById('resultModal')).show();
    }

    function handleSelesaiSeni() {
      if (!currentPartaiData) return;
      ws.send(JSON.stringify({
        type: 'selesai_seni',
        partai: currentPartaiData.partai,
        sudut: currentPartaiData.peserta?.sudut || ''
      }));
      showNotification('âœ… Status SELESAI dikirim', 'success');

      if (localStorage.getItem('partai')) {
        ws.send(JSON.stringify({
          type: 'getNilaiSeniAll',
          partai: localStorage.getItem('partai')
        }));
      }
    }

    function processPartaiResult(data) {
      if (!data) return;
      lastResultData = data;
      $('#modal-partai-title').text(`${currentPartaiData?.partai || '-'} - ${currentPartaiData?.kategori || ''} ${currentPartaiData?.kelas || ''}`);

      const biru = data.sudutBiru || {};
      $('#nama-biru').text(biru.nama || '-');
      $('#kontingen-biru').text(biru.kontingen || '-');
      $('#penalty-biru').text((biru.totalPenalty || 0).toFixed(2));
      $('#total-biru').text((biru.totalScore || 0).toFixed(2));

      const merah = data.sudutMerah || {};
      $('#nama-merah').text(merah.nama || '-');
      $('#kontingen-merah').text(merah.kontingen || '-');
      $('#penalty-merah').text((merah.totalPenalty || 0).toFixed(2));
      $('#total-merah').text((merah.totalScore || 0).toFixed(2));

      const scoreBiru = parseFloat(biru.totalScore) || 0;
      const scoreMerah = parseFloat(merah.totalScore) || 0;

      $('.biru-section, .merah-section').removeClass('winner');
      if (scoreBiru > scoreMerah) $('.biru-section').addClass('winner');
      else if (scoreMerah > scoreBiru) $('.merah-section').addClass('winner');
      else $('.biru-section, .merah-section').addClass('winner');

      new bootstrap.Modal(document.getElementById('resultModal')).show();
    }

    function updateDisplay(data) {
      $('.nm').text(data.peserta?.nama || '-');
      $('.kontingen').text(data.peserta?.kontingen || '-');
      $('.kategori').text(data.kategori || '-');
      $('.kelas').text(data.kelas || '-');
      $('#current-partai').text(data.partai || '-');
      $('#current-sudut').text("SUDUT " + data.peserta?.sudut || '-');
      $('#broadcast-partai').text(`Partai ${data.partai || '-'}`);
    }

    function handleWebSocketMessage(event) {
      try {
        const message = JSON.parse(event.data);
        console.log('ðŸ“¨ WebSocket message:', message.type);

        switch (message.type) {
          case 'partai_data_tunggal':
            handlePartaiData(message.data);
            break;

          case 'broadcast_nilai_seni':
            console.log('ðŸ“Š Broadcast nilai seni:', message.data);
            updateBroadcastDisplay(message.data);
            break;

          case 'broadcast_selesai_seni':
            console.log('ðŸ“Š Broadcast selesai seni:', message.data);
            updateBroadcastDisplay(message.data);
            break;

          case 'tick':
            updateTimer(message.remaining);
            break;

          case 'stopped':
            resetTimer();
            break;

          case 'partai_result_response':
            showNotification('âœ… Data hasil partai diterima!', 'success');
            processPartaiResult(message.data);
            break;

          case 'partai_finish_ack':
            showNotification('âœ… Permintaan hasil partai dikirim!', 'success');
            break;

          case 'winner':
            console.log('ðŸ† Pemenang diterima:', message.data);
            showNotification(`âœ… Pemenang: ${message.data.sudut}`, 'success');
            break;

          case 'error':
            showNotification(`âŒ ${message.message || 'Terjadi kesalahan'}`, 'error');
            break;

          default:
            console.log(`ðŸ“¨ Message type: ${message.type}`);
        }
      } catch (e) {
        console.error('âŒ Error parsing WebSocket message:', e);
      }
    }

    function handlePartaiData(data) {
      Object.keys(localStorage).forEach(key => {
        if (key.startsWith('penalty_')) {
          localStorage.removeItem(key);
        }
      });

      localStorage.setItem('partai', data.partai);
      localStorage.setItem('currentPartai', JSON.stringify(data));
      currentPartaiData = data;

      // RESET TAMPILAN PENALTY KE 0.00 DULU sebelum dapat data broadcast
      for (let i = 1; i <= 5; i++) {
        $(`.target${i}`).text('0.00');
        $(`#penalty-${i}`).removeClass('active');
        $(`#penalty-badge-${i}`).hide();
        $(`#penalty-indicator-${i}`).hide();
      }

      // Update display header
      updateDisplay(data);

      ws.send(JSON.stringify({
        type: 'getNilaiSeniAll',
        partai: data.partai
      }));
    }

    function updateTimer(seconds) {
      const m = Math.floor(seconds / 60);
      const s = seconds % 60;
      $('#timer').text(`â±ï¸ ${String(m).padStart(2, '0')}:${String(s).padStart(2, '0')}`);
    }

    function resetTimer() {
      $('#timer').text('â±ï¸ 02:00');
    }

    function showNotification(message, type = 'info') {
      const notif = document.getElementById('custom-notification');
      if (notif) notif.remove();

      const div = document.createElement('div');
      div.id = 'custom-notification';
      div.style.background = type === 'success' ? '#198754' : type === 'error' ? '#dc3545' : '#0d6efd';
      div.innerHTML = `<span style="font-size:1.5rem">${type === 'success' ? 'âœ…' : type === 'error' ? 'âŒ' : 'â„¹ï¸'}</span><span>${message}</span>`;
      document.body.appendChild(div);
      setTimeout(() => div?.remove(), 3000);
    }

    function konfirmasiKeluar() {
      if (confirm('Keluar aplikasi?')) {
        localStorage.clear();
        window.location.href = 'index.html';
      }
    }

    function konfirmasiRefresh(e) {
      e.preventDefault();
      if (confirm('Refresh halaman?')) location.reload();
    }

    window.openFullscreen = () => {
      document.documentElement.requestFullscreen?.();
      $("#openfull").hide();
      $("#exitfull").show();
    };

    window.closeFullscreen = () => {
      document.exitFullscreen?.();
      $("#openfull").show();
      $("#exitfull").hide();
    };
  </script>
</body>

</html>